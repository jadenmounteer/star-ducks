rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /player-presence/{playerId} {
      allow read: if true;
      allow create, update: if 
        // Ensure required fields exist
        request.resource.data.keys().hasAll(['playerId', 'playerName', 'gameSessionId', 'lastSeen', 'isOnline', 'roles']) &&
        // Ensure playerId in document matches the document ID
        request.resource.data.playerId == playerId &&
        // Basic data validation
        request.resource.data.lastSeen is number &&
        request.resource.data.isOnline is bool &&
        request.resource.data.roles is list;
      allow delete: if true;
    }

    match /game-sessions/{sessionId} {
      allow read: if true;
      allow write: if 
        // Add any game session specific validation rules
        request.resource.data.keys().hasAll(['playerIds', 'entranceCode', 'createdAt', 'lastActive']);
    }
  }
}